metadata:
  test_config: ${test_config}
  fvp_model: ${model}
  build_url: ${BUILD_URL}

$(if [ -n "${gerrit_url}" ]; then
	cat <<-YAML
  gerrit_url: "${gerrit_url}"
	YAML
fi)

device_type: fvp
job_name: ${test_config}

timeouts:
  job:
    minutes: 30
  action:
    minutes: 20
  actions:
    auto-login-action:
      seconds: 300
    lava-test-monitor:
      minutes: 7
    lava-test-interactive:
      minutes: 15
    lava-test-shell:
      seconds: 300
    lava-test-retry:
      seconds: 300
    http-download:
      seconds: 120
    download-retry:
      seconds: 120
    fvp-deploy:
      seconds: 300
  connection:
    seconds: 10
  connections:
    lava-test-retry:
      seconds: 300
    lava-test-monitor:
      seconds: 300
    lava-test-shell:
      seconds: 300
    bootloader-action:
      seconds: 300
    bootloader-retry:
      seconds: 300

priority: medium
visibility: public

actions:
- deploy:
    to: fvp
    images:

$(for artefact in "${artefacts[@]:?}"; do
	cat <<-YAML
      ${artefact:?}:
        url: ${!artefact:?}
	YAML

	[[ "${artefact:?}" =~ ^(busybox|rootfs)$ ]] && cat <<-YAML
        compression: gz
	YAML
done)

- boot:
    method: fvp
    license_variable: ARMLMD_LICENSE_FILE=${armlmd_license_file}
    docker:
      name: ${docker_name}
      local: true
    image: ${model_dir}/${model_bin}
    version_string: ${version_string}
    console_string: 'terminal_0: Listening for serial connection on port (?P<PORT>\d+)'
    feedbacks:
      - '(?P<NAME>terminal_1): Listening for serial connection on port (?P<PORT>\d+)'
      - '(?P<NAME>terminal_2): Listening for serial connection on port (?P<PORT>\d+)'
      - '(?P<NAME>terminal_3): Listening for serial connection on port (?P<PORT>\d+)'
    arguments:
{BOOT_ARGUMENTS}
