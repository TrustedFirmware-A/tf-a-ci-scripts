metadata:
  test_config: {TEST_CONFIG}
  fvp_model: {MODEL}
  build_url: ${BUILD_URL}

$(if [ -n "${gerrit_url}" ]; then
	cat <<-YAML
  gerrit_url: "${gerrit_url}"
	YAML
fi)

device_type: fvp
job_name: fvp-linux-{TEST_CONFIG}

timeouts:
  connection:
    seconds: 10
  job:
    minutes: 30
  action:
    minutes: 20
  actions:
    auto-login-action:
      minutes: 5
    lava-test-monitor:
      minutes: 5
    lava-test-interactive:
      minutes: 15
    lava-test-shell:
      seconds: 300
    http-download:
      minutes: 2
    download-retry:
      minutes: 2
    fvp-deploy:
      minutes: 5

priority: medium
visibility: public

actions:
- deploy:
    to: fvp
    images:

$(for artefact in "${artefacts[@]:?}"; do
	cat <<-YAML
      ${artefact:?}:
        url: ${artefacts_macros[${artefact:?}]:?}
	YAML

	[[ "${artefact:?}" =~ ^(busybox|rootfs)$ ]] && cat <<-YAML
        compression: gz
	YAML
done)

- boot:
    method: fvp
    license_variable: ARMLMD_LICENSE_FILE={ARMLMD_LICENSE_FILE}
    docker:
      name: {BOOT_DOCKER_NAME}
      local: true
    image: {BOOT_IMAGE_DIR}/{BOOT_IMAGE_BIN}
    version_string: {BOOT_VERSION_STRING}
    console_string: 'terminal_0: Listening for serial connection on port (?P<PORT>\d+)'
    feedbacks:
      - '(?P<NAME>terminal_1): Listening for serial connection on port (?P<PORT>\d+)'
      - '(?P<NAME>terminal_2): Listening for serial connection on port (?P<PORT>\d+)'
      - '(?P<NAME>terminal_3): Listening for serial connection on port (?P<PORT>\d+)'
    timeout:
      minutes: 30
    arguments:
{BOOT_ARGUMENTS}
